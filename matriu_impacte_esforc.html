<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matriu Impacte-Esforç - Suara Cooperativa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.24.1/plotly.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            padding: 20px;
            width: 95vw;
            height: 90vh;
            max-width: 1400px;
            max-height: 900px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            border-radius: 10px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }
        
        .header p {
            margin: 8px 0 0 0;
            font-size: 1em;
            opacity: 0.9;
        }
        
        #chartDiv {
            width: 100%;
            height: calc(100% - 120px);
            min-height: 600px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: #3498db;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Matriu Impacte-Esforç</h1>
            <p>33 Propostes d'Acció • Projecte 24/7 • Suara Cooperativa</p>
        </div>
        
        <div class="controls">
            <button class="control-btn active" onclick="showAllModules()">Tots els Mòduls</button>
            <button class="control-btn" onclick="showQuickWins()">Quick Wins</button>
            <button class="control-btn" onclick="showMajorProjects()">Major Projects</button>
            <button class="control-btn" onclick="resetZoom()">Reset Zoom</button>
        </div>
        
        <div id="chartDiv"></div>
    </div>

    <script>
        // Dades de les 33 propostes d'acció
        const acciones = [
            {codi: 'S1', impacte: 10, esforç: 8, modul: 'SAP', item: 2, descripcio: 'Garantir PCI-DSS per servidors financers'},
            {codi: 'S2', impacte: 9, esforç: 8, modul: 'Hubspot i Drupal', item: 4, descripcio: 'Establir repositori únic dades bancàries'},
            {codi: 'S3', impacte: 9, esforç: 6, modul: 'SAP', item: 1, descripcio: 'Implementar protocols encriptació TLS/VPN'},
            {codi: 'S4', impacte: 8, esforç: 6, modul: 'Hubspot i Drupal', item: 5, descripcio: 'Definir entorn proves versions beta'},
            {codi: 'S5', impacte: 10, esforç: 9, modul: 'General', item: 27, descripcio: 'Aplicar RBAC/ABAC homogeni'},
            {codi: 'S6', impacte: 10, esforç: 5, modul: 'General', item: 29, descripcio: 'Assegurar compliment AI Act'},
            {codi: 'S7', impacte: 10, esforç: 7, modul: 'Jano', item: 3, descripcio: 'Definir procés backup Jano'},
            {codi: 'S8', impacte: 9, esforç: 5, modul: 'Casal TV', item: 8, descripcio: 'Crear política accés Google Workspace'},
            {codi: 'S9', impacte: 10, esforç: 6, modul: 'Llars connectades', item: 9, descripcio: 'Política consentiment dades biomètriques'},
            {codi: 'S10', impacte: 6, esforç: 3, modul: 'SAP', item: 10, descripcio: 'Validar política backup SAP'},
            {codi: 'S11', impacte: 5, esforç: 3, modul: 'Hubspot i Drupal', item: 12, descripcio: 'Revisar permisos equips Hubspot'},
            {codi: 'S12', impacte: 6, esforç: 3, modul: 'Hubspot i Drupal', item: 16, descripcio: 'Validar backups Moodle/AWS'},
            {codi: 'G1', impacte: 9, esforç: 9, modul: 'General', item: 19, descripcio: 'Pla validació correctesa dades'},
            {codi: 'G2', impacte: 9, esforç: 10, modul: 'General', item: 20, descripcio: 'Mòdul centralitzat sanejament dades'},
            {codi: 'G3', impacte: 8, esforç: 8, modul: 'General', item: 30, descripcio: 'Consolidar dades mèdiques duplicades'},
            {codi: 'G4', impacte: 9, esforç: 6, modul: 'Middleware N8N/MongoDB', item: 6, descripcio: 'Persistència PostgreSQL N8N'},
            {codi: 'G5', impacte: 9, esforç: 9, modul: 'General', item: 28, descripcio: 'Ens centralitzat gestió usuaris'},
            {codi: 'G6', impacte: 9, esforç: 6, modul: 'Middleware N8N/MongoDB', item: 31, descripcio: 'Definir casos ús IA Engine'},
            {codi: 'G7', impacte: 9, esforç: 10, modul: 'General', item: 21, descripcio: 'Redefinir arquitectura emmagatzematge'},
            {codi: 'G8', impacte: 10, esforç: 10, modul: 'General', item: 22, descripcio: 'Motor orquestració integració dades'},
            {codi: 'I1', impacte: 8, esforç: 8, modul: 'General', item: 23, descripcio: 'Pla profiling dades'},
            {codi: 'I2', impacte: 7, esforç: 5, modul: 'General', item: 24, descripcio: 'Política selecció proveïdors cloud'},
            {codi: 'I3', impacte: 7, esforç: 6, modul: 'General', item: 18, descripcio: 'Responsables recolzament mòduls'},
            {codi: 'I4', impacte: 7, esforç: 8, modul: 'Middleware N8N/MongoDB', item: 13, descripcio: 'Configurar alta disponibilitat'},
            {codi: 'A1', impacte: 7, esforç: 6, modul: 'Jano', item: 11, descripcio: 'Automatitzar transferència IBAN'},
            {codi: 'A2', impacte: 8, esforç: 7, modul: 'General', item: 25, descripcio: 'Procés validació dades defuncions'},
            {codi: 'A3', impacte: 6, esforç: 5, modul: 'Middleware N8N/MongoDB', item: 14, descripcio: 'Política REST serveis N8N'},
            {codi: 'A4', impacte: 8, esforç: 7, modul: 'Casal TV', item: 7, descripcio: 'Migrar dades Casal a Hubspot'},
            {codi: 'A5', impacte: 7, esforç: 7, modul: 'Llars connectades', item: 32, descripcio: 'Integrar Llars al data lake'},
            {codi: 'A6', impacte: 7, esforç: 5, modul: 'Llars connectades', item: 15, descripcio: 'Automatitzar alta Campus Suara'},
            {codi: 'D1', impacte: 7, esforç: 7, modul: 'General', item: 26, descripcio: 'Estandarditzar documentació'},
            {codi: 'D2', impacte: 6, esforç: 4, modul: 'General', item: 33, descripcio: 'Recabar documentació tècnica'},
            {codi: 'D3', impacte: 6, esforç: 7, modul: 'Llars connectades', item: 17, descripcio: 'Mapa dades Llars connectades'}
        ];

        // Colors per mòdul
        const modulColors = {
            'SAP': '#FF6B6B',
            'Hubspot i Drupal': '#4ECDC4',
            'General': '#45B7D1',
            'Jano': '#96CEB4',
            'Casal TV': '#FECA57',
            'Llars connectades': '#FF9FF3',
            'Middleware N8N/MongoDB': '#54A0FF'
        };

        // Agrupar per mòdul per crear traces
        const moduls = [...new Set(acciones.map(a => a.modul))];
        const traces = moduls.map(modul => {
            const accionesModul = acciones.filter(a => a.modul === modul);
            return {
                x: accionesModul.map(a => a.esforç),
                y: accionesModul.map(a => a.impacte),
                text: accionesModul.map(a => a.codi),
                customdata: accionesModul.map(a => ({
                    codi: a.codi,
                    item: a.item,
                    descripcio: a.descripcio,
                    modul: a.modul
                })),
                mode: 'markers+text',
                type: 'scatter',
                name: modul,
                marker: {
                    color: modulColors[modul],
                    size: 14,
                    line: { color: 'white', width: 2 }
                },
                textposition: 'middle center',
                textfont: { 
                    color: '#2c3e50', 
                    size: 11, 
                    family: 'Arial Black' 
                },
                hovertemplate: 
                    '<b>%{customdata.codi}</b> (Item %{customdata.item})<br>' +
                    'Impacte: %{y}<br>' +
                    'Esforç: %{x}<br>' +
                    'Mòdul: %{customdata.modul}<br>' +
                    '%{customdata.descripcio}<br>' +
                    '<extra></extra>'
            };
        });

        const layout = {
            title: {
                text: 'Matriu Impacte vs Esforç - 33 Propostes d\'Acció',
                font: { size: 20, color: '#2c3e50' }
            },
            xaxis: {
                title: 'ESFORÇ →',
                range: [0, 11],
                dtick: 1,
                showgrid: true,
                gridcolor: 'rgba(128,128,128,0.3)',
                zeroline: false
            },
            yaxis: {
                title: '↑ IMPACTE',
                range: [0, 11],
                dtick: 1,
                showgrid: true,
                gridcolor: 'rgba(128,128,128,0.3)',
                zeroline: false
            },
            showlegend: true,
            legend: {
                orientation: 'h',
                y: -0.2,
                x: 0.5,
                xanchor: 'center'
            },
            plot_bgcolor: 'white',
            paper_bgcolor: 'white',
            margin: { t: 80, b: 100, l: 80, r: 50 },
            shapes: [
                // Línia vertical (esforç mitjà)
                {
                    type: 'line',
                    x0: 5.5, x1: 5.5,
                    y0: 0, y1: 11,
                    line: { color: 'rgba(128,128,128,0.5)', width: 2, dash: 'dash' }
                },
                // Línia horitzontal (impacte mitjà)
                {
                    type: 'line',
                    x0: 0, x1: 11,
                    y0: 7.5, y1: 7.5,
                    line: { color: 'rgba(128,128,128,0.5)', width: 2, dash: 'dash' }
                }
            ],
            annotations: [
                // Etiquetes dels quadrants
                { x: 2.75, y: 9.5, text: '🚀 QUICK WINS', showarrow: false, font: { size: 14, color: '#27ae60' } },
                { x: 8.25, y: 9.5, text: '🏗️ MAJOR PROJECTS', showarrow: false, font: { size: 14, color: '#e74c3c' } },
                { x: 2.75, y: 3.75, text: '📝 FILL-INS', showarrow: false, font: { size: 14, color: '#95a5a6' } },
                { x: 8.25, y: 3.75, text: '⚠️ THANKLESS TASKS', showarrow: false, font: { size: 14, color: '#f39c12' } }
            ]
        };

        const config = {
            responsive: true,
            displayModeBar: true,
            modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
            displaylogo: false,
            toImageButtonOptions: {
                format: 'png',
                filename: 'matriu_impacte_esforç_suara',
                height: 800,
                width: 1200,
                scale: 2
            }
        };

        // Crear el gràfic
        Plotly.newPlot('chartDiv', traces, layout, config);

        // Funcions de control
        function showAllModules() {
            Plotly.restyle('chartDiv', { visible: true }, Array.from({length: traces.length}, (_, i) => i));
            updateActiveButton(0);
        }

        function showQuickWins() {
            const quickWins = acciones.filter(a => a.impacte >= 8 && a.esforç <= 6);
            highlightActions(quickWins);
            updateActiveButton(1);
        }

        function showMajorProjects() {
            const majorProjects = acciones.filter(a => a.impacte >= 8 && a.esforç >= 7);
            highlightActions(majorProjects);
            updateActiveButton(2);
        }

        function resetZoom() {
            Plotly.relayout('chartDiv', {
                'xaxis.range': [0, 11],
                'yaxis.range': [0, 11]
            });
            updateActiveButton(3);
        }

        function highlightActions(actionsToShow) {
            const codisToShow = actionsToShow.map(a => a.codi);
            
            traces.forEach((trace, i) => {
                const shouldShow = trace.text.some(codi => codisToShow.includes(codi));
                Plotly.restyle('chartDiv', { 
                    visible: shouldShow,
                    'marker.opacity': shouldShow ? 1 : 0.3
                }, [i]);
            });
        }

        function updateActiveButton(activeIndex) {
            const buttons = document.querySelectorAll('.control-btn');
            buttons.forEach((btn, i) => {
                btn.classList.toggle('active', i === activeIndex);
            });
        }
    </script>
</body>
</html>
